<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Character encoding for correct text rendering -->
  <meta charset="UTF-8" />

  <!-- Page title shown in browser tab -->
  <title>Sign In</title>

  <!-- Responsive viewport for mobile & desktop -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS for layout, grid, and components -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Bootstrap Icons for eye icon and UI symbols -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <style>
    /* Full-screen centered layout with soft gradient background */
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #f1f3f5, #e9ecef);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Keyframe animation for alert "pop" effect */
    @keyframes popIn {
      0% { opacity: 0; transform: translateY(10px) scale(0.95); }
      60% { opacity: 1; transform: translateY(-2px) scale(1.02); }
      100% { transform: translateY(0) scale(1); }
    }

    /* Applied to alerts to animate them sequentially */
    .alert-pop {
      animation: popIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
      animation-delay: calc(var(--i) * 0.08s);
    }

    /* Fixed stack position for flash messages */
    .alert-stack {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1050;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 300px;
    }

    /* Main authentication card styling */
    .auth-card {
      max-width: 480px;
      width: 100%;
      padding: 40px;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
    }

    /* Input field styling */
    .form-control {
      border-radius: 10px;
      padding: 12px;
    }

    /* Primary button styling */
    .btn-main {
      border-radius: 10px;
      padding: 12px;
      font-weight: 600;
    }
  </style>
</head>

<body>

<!-- ================= FLASH ALERTS ================= -->
<div class="alert-stack">
  <!-- Retrieve flashed messages with categories from Flask -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div
          class="alert alert-{{ category }} alert-dismissible fade show alert-pop"
          style="--i: {{ loop.index0 }}"
          role="alert"
        >
          <!-- Flash message text -->
          {{ message }}

          <!-- Close button -->
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<!-- ================= SIGN-IN CARD ================= -->
<div class="auth-card text-center">
  <!-- Heading -->
  <h4 class="mb-3">Welcome Back</h4>

  <!-- Subtext -->
  <p class="text-muted mb-4">Sign in to continue</p>

  <!-- Login form submits to /sign-in route -->
  <form action="/sign-in" method="POST">

    <!-- Username input -->
    <div class="mb-3 text-start">
      <label class="form-label fw-semibold">Username</label>
      <input type="text" class="form-control" name="username" required />
    </div>

    <!-- Password input with visibility toggle -->
    <div class="mb-4 text-start">
      <label class="form-label fw-semibold">Password</label>
      <div class="input-group">
        <input
          type="password"
          class="form-control"
          id="password"
          name="password"
          required
        />

        <!-- Toggle password visibility -->
        <button
          class="btn btn-outline-secondary"
          type="button"
          onclick="togglePassword()"
        >
          <i class="bi bi-eye" id="eyeIcon"></i>
        </button>
      </div>
    </div>

    <!-- Submit button -->
    <button type="submit" class="btn btn-dark btn-main w-100 mb-3">
      Sign In
    </button>
  </form>

  <!-- Link to sign-up page -->
  <p class="mb-0">
    New user?
    <a href="{{ url_for('sign_up') }}" class="fw-semibold text-decoration-none">
      Create an account
    </a>
  </p>
</div>

<!-- Bootstrap JS (required for alerts, dismiss, etc.) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
  /* ===== Auto-dismiss flash alerts after 3 seconds ===== */
  setTimeout(() => {
    document.querySelectorAll(".alert").forEach(alert => {
      const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
      bsAlert.close();
    });
  }, 3000);

  /* ===== Toggle password visibility ===== */
  function togglePassword() {
    const passwordInput = document.getElementById("password");
    const eyeIcon = document.getElementById("eyeIcon");

    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      eyeIcon.classList.replace("bi-eye", "bi-eye-slash");
    } else {
      passwordInput.type = "password";
      eyeIcon.classList.replace("bi-eye-slash", "bi-eye");
    }
  }
</script>

</body>
</html>
