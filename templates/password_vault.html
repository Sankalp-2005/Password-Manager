<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Password Vault</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: linear-gradient(180deg, #f1f5f9 0%, #ffffff 100%);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      .vault-card {
        border-radius: 26px;
        background: #ffffff;
      }

      .vault-header {
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 1rem;
        margin-bottom: 2rem;
      }

      .vault-item {
        border-radius: 16px;
        padding: 1.1rem 5rem 1.1rem 1.25rem;
        margin-bottom: 0.8rem;
        position: relative;
        transition: background 0.2s ease;
      }

      .vault-item:hover {
        background: #f8fafc;
      }

      .floating-actions {
        position: absolute;
        right: 1.25rem;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        gap: 0.75rem;
      }

      .floating-actions a,
      .floating-actions button {
        background: transparent;
        border: none;
        color: #111827;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        transition: background 0.15s ease, color 0.15s ease;
      }

      .floating-actions a:hover,
      .floating-actions button:hover {
        background: #e5e7eb;
      }

      .floating-actions .delete:hover {
        background: #fee2e2;
        color: #dc2626;
      }

      .add-btn {
        border-radius: 18px;
        padding: 1.05rem;
        font-weight: 600;
        font-size: 1rem;
      }

      .logout-btn {
        border-radius: 12px;
      }

      .alert-stack {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1050;
        min-width: 320px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
    </style>
  </head>

  <body>
    <div class="alert-stack">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %} {% if category ==
      'copy' %}
      <script>
        copyToClipboard("{{ message[8:] }}");
      </script>
      {% else %}
      <div
        class="alert alert-{{ category }} alert-dismissible fade show"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endif %} {% endfor %} {% endif %} {% endwith %}
    </div>

    <div
      class="container min-vh-100 d-flex align-items-center justify-content-center"
    >
      <div
        class="card shadow-xl border-0 vault-card w-100"
        style="max-width: 920px"
      >
        <div class="card-body p-4 p-md-5">
          <div
            class="d-flex justify-content-between align-items-center vault-header"
          >
            <div>
              <h5 class="mb-0 fw-bold">Personal Vault</h5>
              <small class="text-muted">Securely stored credentials</small>
            </div>

            <a href="{{ url_for('logout') }}" class="btn btn-sm logout-btn">
              <i class="bi bi-box-arrow-right me-1"></i> Logout
            </a>
          </div>

          <div class="list-group list-group-flush mb-4">
            {% if vault and vault|length > 0 %} {% for site in vault.keys() %}
            <div class="list-group-item border-0 vault-item">
              <span
                class="fw-medium fs-6 view-link"
                data-url="{{ url_for('view_password', site=site) }}"
                style="cursor: pointer"
              >
                {{ site }}
              </span>

              <div class="floating-actions">
                <a
                  href="{{ url_for('update_password', site=site) }}"
                  aria-label="Edit"
                >
                  <i class="bi bi-pencil"></i>
                </a>

                <form
                  action="{{ url_for('delete_password', site=site) }}"
                  method="POST"
                  onsubmit="return confirm('Delete this password?');"
                >
                  <button class="delete" type="submit" aria-label="Delete">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
              </div>
            </div>
            {% endfor %} {% else %}
            <div class="text-center text-muted py-4">
              You don't have any passwords saved. Click below to add one.
            </div>
            {% endif %}
          </div>

          <div class="d-grid">
            <a
              href="{{ url_for('add_password') }}"
              class="btn btn-primary btn-lg add-btn"
            >
              <i class="bi bi-plus-circle me-2"></i>
              Add New Password
            </a>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      setTimeout(() => {
        document.querySelectorAll(".alert").forEach((alert) => {
          const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
          bsAlert.close();
        });
      }, 3000);
      document.querySelectorAll(".view-link").forEach((el) => {
        el.ondblclick = () => {
          window.location = el.dataset.url;
        };
      });
    </script>
  </body>
</html>
